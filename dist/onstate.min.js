/* onstate 0.3.0 - https://github.com/passpill-io/onState */
!function(t,e){"function"==typeof define&&define.amd?define(["exports","onState"],e):"object"==typeof exports?module.exports=e():t.onState=e()}(this,function(){"use strict";const t=new Set(["_reState","state"]);function e(t){console.warn("onState WARNING: "+t)}var n={on:function(t,n){return t?"function"!=typeof n?e("No listener provided for the event '"+t+"'."):void(this.__.clbks[t]?this.__.clbks[t].push(n):this.__.clbks[t]=[n]):e("Can't add listener for a falsy event.")},off:function(t,n){var r=this.__.clbks[t],i="Couldn't find the listener to remove from the event '"+t+"'.";if(!r)return e(i);var o=r.indexOf(n);-1!==o?r.splice(o,1):e(i)},emit:function(e){var n=Array.from(arguments),i=r.apply(null,[this.__].concat(n));if(t.has(e))return i;for(var o=this.__.parent;o;)r.apply(null,[o].concat(n)),o=o.parent;return i}};function r(t,n){if(t.clbks[n]){var r,i,o=Array.from(arguments).slice(2);return t.clbks[n].forEach(t=>{void 0!==(i=t.apply(null,o))&&(r=i)}),r}"_reState"===n&&e("Changing a detached node. It won't emit `state` events.")}function i(t){t.timer||(t.timer=setTimeout(()=>{r(t,"_reState"),t.timer=!1}))}var o={set:function(t,n,r){!this.__.init&&r&&r.__&&r.__.parent&&!this.__.splicing&&function(t){throw new Error(t)}("Can't add an oS node to another oS object."),r&&!r.__&&(r.on||r.emit)&&e("Adding an object with `on` or `emit` attributes. They will be overriden.");var o=r instanceof Object,_=o?s(r):r,a=t[n];return a&&a.__&&(a.__.parent=!1),o&&(_.__.parent=this.__),Reflect.set(t,n,_),this.__.init||i(this.__),!0},deleteProperty:function(t,e){var n=t[e];return n&&n.__&&(n.__.parent=!1),Reflect.deleteProperty(t,e),i(this.__),!0},get:function(t,e){return t.splice&&"splice"===e&&(this.__.splicing=!0,setTimeout(()=>delete this.__.splicing)),"__"===e?this.__:n[e]?n[e]:t[e]||t.hasOwnProperty(e)?t[e]:Reflect.get(t,e)}};function _(t){var e,n=t.splice?[]:{},i={parent:!1,clbks:{},timer:!1,init:!0},s=Object.assign({__:i},o),a=new Proxy(n,s);for(e in t)a[e]=t[e];if(t&&t.__&&t.__.clbks)for(e in t.__.clbks)"_reState"!==e&&(i.clbks[e]=t.__.clbks[e]);return delete i.init,a.on("_reState",function(t,e){!function(t,e,n){if(e)for(var i in t)if(t[i]===e){e.__.clbks={},Reflect.set(t,i,n);break}var o=_(t),s=t.__;t.emit("state",o),clearTimeout(s.timer),s.timer=!1,s.parent&&r(s.parent,"_reState",t,o)}(a,t,e)}),a}function s(t){return function(t){return t&&t.__}(t)?t:_(t)}return s});