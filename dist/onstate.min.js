/* onstate 0.2.0 - https://github.com/passpill-io/onState */
!function(t,e){"function"==typeof define&&define.amd?define(["exports","onState"],e):"object"==typeof exports?module.exports=e():t.onState=e()}(this,function(){"use strict";const t=new Set(["_reState","state"]);var e={on:function(t,e){this.__.listeners[t]?this.__.listeners[t].push(e):this.__.listeners[t]=[e]},emit:function(e){var r=[this.__].concat(Array.from(arguments));n.apply(this,r),t.has(e)||this.__.parent&&p.emit.apply(this.__.parent,r)}};function n(t,e){if(t.listeners[e]){var n=Array.from(arguments).slice(2);t.listeners[e].forEach(t=>{t.apply(null,n)})}}function r(t){t.timer||(t.timer=setTimeout(()=>{n(t,"_reState")}))}var i={set:function(t,e,n){var i;!this.__.init&&n&&n.__&&n.__.parent&&function(t){throw new Error(t)}("Can't add an oS node to another oS object."),n&&!n.__&&(n.on||n.emit)&&(i="Adding an object with `on` or `emit` attributes. They will be overriden.",console.warn("onState WARNING: "+i));var o=n instanceof Object,a=o?_(n):n,s=t[e];return s&&s.__&&(s.__.parent=!1),o&&(a.__.parent=this.__),Reflect.set(t,e,a),this.__.init||r(this.__),!0},deleteProperty:function(t,e){var n=t[e];return n&&n.__&&(n.__.parent=!1),Reflect.deleteProperty(t,e),r(this.__),!0},get:function(t,n){return"__"===n?this.__:e[n]?e[n]:t[n]||t.hasOwnProperty(n)?t[n]:Reflect.get(t,n)}};function o(t){var e,r=t.splice?[]:{},_={parent:!1,listeners:{},timer:!1,init:!0},a=Object.assign({__:_},i),s=new Proxy(r,a);for(e in t)s[e]=t[e];return delete _.init,s.on("_reState",function(t,e){!function(t,e,r){if(e)for(var i in t)if(t[i]===e){Reflect.set(t,i,r);break}var _=o(t),a=t.__;t.emit("state",_),clearTimeout(a.timer),a.timer=!1,a.parent&&n(a.parent,"_reState",t,_)}(s,t,e)}),s}function _(t){return function(t){return t&&t.__}(t)?t:o(t)}return _});