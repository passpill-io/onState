/* onstate 0.3.0 - https://github.com/passpill-io/onState */
!function(t,e){"function"==typeof define&&define.amd?define(["exports","onState"],e):"object"==typeof exports?module.exports=e():t.onState=e()}(this,function(){"use strict";const t=new Set(["_reState","state"]);function e(t){console.warn("onState WARNING: "+t)}var n={on:function(t,n){return t?"function"!=typeof n?e("No listener provided for the event '"+t+"'."):void(this.__.clbks[t]?this.__.clbks[t].push(n):this.__.clbks[t]=[n]):e("Can't add listener for a falsy event.")},off:function(t,n){var i=this.__.clbks[t],r="Couldn't find the listener to remove from the event '"+t+"'.";if(!i)return e(r);var o=i.indexOf(n);-1!==o?i.splice(o,1):e(r)},emit:function(e){var n=Array.from(arguments);if(i.apply(null,[this.__].concat(n)),!t.has(e))for(var r=this.__.parent;r;)i.apply(null,[r].concat(n)),r=r.parent}};function i(t,e){if(t.clbks[e]){var n=Array.from(arguments).slice(2);t.clbks[e].forEach(t=>{t.apply(null,n)})}}function r(t){t.timer||(t.timer=setTimeout(()=>{i(t,"_reState")}))}var o={set:function(t,n,i){!this.__.init&&i&&i.__&&i.__.parent&&!this.__.splicing&&function(t){throw new Error(t)}("Can't add an oS node to another oS object."),i&&!i.__&&(i.on||i.emit)&&e("Adding an object with `on` or `emit` attributes. They will be overriden.");var o=i instanceof Object,_=o?a(i):i,s=t[n];return s&&s.__&&(s.__.parent=!1),o&&(_.__.parent=this.__),Reflect.set(t,n,_),this.__.init||r(this.__),!0},deleteProperty:function(t,e){var n=t[e];return n&&n.__&&(n.__.parent=!1),Reflect.deleteProperty(t,e),r(this.__),!0},get:function(t,e){return t.splice&&"splice"===e&&(this.__.splicing=!0,setTimeout(()=>delete this.__.splicing)),"__"===e?this.__:n[e]?n[e]:t[e]||t.hasOwnProperty(e)?t[e]:Reflect.get(t,e)}};function _(t){var e,n=t.splice?[]:{},r={parent:!1,clbks:{},timer:!1,init:!0},a=Object.assign({__:r},o),s=new Proxy(n,a);for(e in t)s[e]=t[e];return delete r.init,s.on("_reState",function(t,e){!function(t,e,n){if(e)for(var r in t)if(t[r]===e){Reflect.set(t,r,n);break}var o=_(t),a=t.__;t.emit("state",o),clearTimeout(a.timer),a.timer=!1,a.parent&&i(a.parent,"_reState",t,o)}(s,t,e)}),s}function a(t){return function(t){return t&&t.__}(t)?t:_(t)}return a});