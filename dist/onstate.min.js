/* onstate 0.2.0 - https://github.com/passpill-io/onState */
!function(t,e){"function"==typeof define&&define.amd?define(["exports","onState"],e):"object"==typeof exports?module.exports=e():t.onState=e()}(this,function(){"use strict";const t=new Set(["_reState","state"]);var e={on:function(t,e){this.__.listeners[t]?this.__.listeners[t].push(e):this.__.listeners[t]=[e]},emit:function(e){var r=[this.__].concat(Array.from(arguments));n.apply(this,r),t.has(e)||this.__.parents.forEach(t=>{t.emit.apply(t,r)})},_addParent:function(t){this.__.parents.push(t)},_delParent:function(t){var e=this.__.parents.indexOf(t);-1!==e&&this.__.parents.splice(e,1)}};function n(t,e){if(t.listeners[e]){var n=Array.from(arguments).slice(2);t.listeners[e].forEach(t=>{t.apply(null,n)})}}function r(t){t.timer||(t.timer=setTimeout(()=>{n(t,"_reState")}))}var i={set:function(t,e,n){var i=n instanceof Object,s=i?a(n):n,o=t[e];return o&&o._delParent&&o._delParent(this.__),i&&s._addParent(this.__),Reflect.set(t,e,s),r(this.__),!0},deleteProperty:function(t,e){var n=t[e];return n&&n._delParent&&n._delParent(this.__),Reflect.deleteProperty(t,e),r(this.__),!0},get:function(t,n){return"__"===n?this.__:e[n]?e[n]:t[n]||t.hasOwnProperty(n)?t[n]:Reflect.get(t,n)}};function s(t){var e,r=t.splice?[]:{},a={parents:[],listeners:{},timer:!0},o=Object.assign({__:a},i),_=new Proxy(r,o);for(e in t)_[e]=t[e];return _.on("_reState",function(t,e){!function(t,e,r){if(e)for(var i in t)if(t[i]===e){Reflect.set(t,i,r);break}var a=s(t),o=t.__;t.emit("state",a),clearTimeout(o.timer),o.timer=!1,o.parents.forEach(e=>{n(e,"_reState",t,a)})}(_,t,e)}),a.timer=!1,_}function a(t){return function(t){return t&&"function"==typeof t._delParent}(t)?t:s(t)}return a});